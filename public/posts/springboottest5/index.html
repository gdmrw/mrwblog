<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Spring Boot Software Testing 5 - Testable Design and Mocking | Mr.W's Blog</title>
<meta name=keywords content="Spring Boot,Java,Actuator"><meta name=description content="Testable Design and Mocking What is testable design, and what kinds of design in java are testable?
In Java, achieving a testable design is about adhering to principles and practices that minimize coupling, maximize cohesion, and facilitate isolation of components for testing. It involves strategic use of design patterns, architectural decisions that favor testability, and leveraging tools and frameworks that support automated testing. This approach not only makes your code more testable but also improves its overall design and maintainability."><meta name=author content="Mr.W"><link rel=canonical href=http://localhost:1313/posts/springboottest5/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.0c29b72807c09f5230c0c62ce30f65195ac1ad1360c84643b40b0e5f08be2e56.css integrity="sha256-DCm3KAfAn1IwwMYs4w9lGVrBrRNgyEZDtAsOXwi+LlY=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/springboottest5/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=disabled"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","disabled")}</script><meta property="og:title" content="Spring Boot Software Testing 5 - Testable Design and Mocking"><meta property="og:description" content="Testable Design and Mocking What is testable design, and what kinds of design in java are testable?
In Java, achieving a testable design is about adhering to principles and practices that minimize coupling, maximize cohesion, and facilitate isolation of components for testing. It involves strategic use of design patterns, architectural decisions that favor testability, and leveraging tools and frameworks that support automated testing. This approach not only makes your code more testable but also improves its overall design and maintainability."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/springboottest5/"><meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-04T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-04T00:00:00+00:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Spring Boot Software Testing 5 - Testable Design and Mocking"><meta name=twitter:description content="Testable Design and Mocking What is testable design, and what kinds of design in java are testable?
In Java, achieving a testable design is about adhering to principles and practices that minimize coupling, maximize cohesion, and facilitate isolation of components for testing. It involves strategic use of design patterns, architectural decisions that favor testability, and leveraging tools and frameworks that support automated testing. This approach not only makes your code more testable but also improves its overall design and maintainability."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Spring Boot Software Testing 5 - Testable Design and Mocking","item":"http://localhost:1313/posts/springboottest5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Spring Boot Software Testing 5 - Testable Design and Mocking","name":"Spring Boot Software Testing 5 - Testable Design and Mocking","description":"Testable Design and Mocking What is testable design, and what kinds of design in java are testable?\nIn Java, achieving a testable design is about adhering to principles and practices that minimize coupling, maximize cohesion, and facilitate isolation of components for testing. It involves strategic use of design patterns, architectural decisions that favor testability, and leveraging tools and frameworks that support automated testing. This approach not only makes your code more testable but also improves its overall design and maintainability.","keywords":["Spring Boot","Java","Actuator"],"articleBody":"Testable Design and Mocking What is testable design, and what kinds of design in java are testable?\nIn Java, achieving a testable design is about adhering to principles and practices that minimize coupling, maximize cohesion, and facilitate isolation of components for testing. It involves strategic use of design patterns, architectural decisions that favor testability, and leveraging tools and frameworks that support automated testing. This approach not only makes your code more testable but also improves its overall design and maintainability.\nDummy code in Spring boot Unfortunately, finding a code that is hard to test is nearly impossible in Spring Boot.In other words, Spring Boot is a near perfect project(in testable level), which is in line with its dominant position in the java framework system.\nHere is the reason why hard-to-test code hardly exists in Spring Boot:\n1. Spring DI IOC container One of the major features of spring boot is the extensive use of Java reflection for dependency injection and inversion of control. This is the core of spring framework.Dependency injection makes it easy to replace actual dependencies in a test environment, using a simplified implementation or an instance created specifically for testing purposes.\n2. full application context @SpringBootTest Spring provides a powerful test context framework that supports test configuration classes and test data management. Besides, Spring Boot provides rich testing support, including annotations and tools for unit testing and integration testing, such as @SpringBootTest, @DataJpaTest, @WebMvcTest, etc. These tools and annotations simplify the setup of test environments, allowing developers to quickly write and execute tests, whether for a specific layer (such as the web layer, service layer, or persistence layer) or for the entire application.\n3. AutoConfiguration Different from a traditional Spring framework, Spring Boot uses autoconfigure to ensures the consistency and correctness of configuration. In a test environment, this means that the same auto-configuration principles can be used to set up the test environment, reducing testing problems caused by improperly configured test environments.\n4. Environment Abstractions Spring Boot provides a variety of environment abstractions, such as configuration files and configuration classes, allowing developers to flexibly configure applications according to the running environment (development, testing, production, etc.). These abstractions also apply to the test environment, making it easy to adjust the configuration of the test environment (such as database connections, external services, etc.) and avoid hardcoding these settings.\nIn summary, I think it is extremely difficult for dummy code to exist in the spring boot repo; mostly it will be rejected by the pull request peer review; And it will be short-term existence even if it does appear.\nMocking Mocking is a technique used in unit testing to simulate the behavior of real objects in a controlled way. It allows developers to isolate the unit of code they are testing by replacing its dependencies with mock objects. These mock objects can mimic the behavior of complex, real-world dependencies such as databases, web services, or other external systems without the overhead of setting up actual connections or state. Mocking is particularly useful in situations where the real dependencies are unreliable, slow, or difficult to configure for testing purposes.\nMocking is typically achieved using specialized libraries or frameworks designed for this purpose. Some popular mocking frameworks in the Java ecosystem include Mockito, JMock, and EasyMock. These frameworks provide annotations and APIs to create mock objects, define their behavior (e.g., specifying what values they should return when certain methods are called), and verify that they were interacted with in expected ways.\nSpring Boot In the process of observing spring boot testing, I found that spring boot rarely uses mocking to test their components. In spring boot philosophy, they tend to make the testing more simply. Spring Boot encourages testing with real components to ensure that parts of the application work together as expected. According to my rough statistics, only 1% of the code uses mockito, and most of this is intentional.\nI made two test cases in spring boot actuator smoke test here is the detailed case:\nThe first case use the build-in mock call mockMvc, the other one is traditional mockito.\nThe first one is preferred in a current scenario. The mockito one is runnable but not recommended.\nMockMvc provides a powerful API that allows you to simulate HTTP requests and responses in order to test the behavior of the web layer without starting a full HTTP server. Mockito is more used for general unit testing, especially when you need to simulate class or method behavior.\nThe first one interacts directly with the spring boot controller, constructs an http request, and verifies the response status code\nThe second one created a fictional ResponseEntity and mock the RestTemplate, the MockResponseEntity will return when specific url get call. The ResponseEnitity will return a small string that is some of the expected data and a http status code. However, this method has limitations because it does not actually construct an http request and call the actuator component, and may not reflect the real situation when the system is deployed.\nBoth tests passed.\n","wordCount":"838","inLanguage":"en","image":"http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-04-04T00:00:00Z","dateModified":"2024-04-04T00:00:00Z","author":{"@type":"Person","name":"Mr.W"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/springboottest5/"},"publisher":{"@type":"Organization","name":"Mr.W's Blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/archives/ title=Archieves><span>Archieves</span></a></li><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://localhost:1313/archive/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Spring Boot Software Testing 5 - Testable Design and Mocking</h1><div class=post-meta><span title='2024-04-04 00:00:00 +0000 UTC'>April 4, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;838 words&nbsp;·&nbsp;Mr.W</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#testable-design-and-mocking aria-label="Testable Design and Mocking">Testable Design and Mocking</a><ul><li><a href=#dummy-code-in-spring-boot aria-label="Dummy code in Spring boot">Dummy code in Spring boot</a><ul><li><a href=#1-spring-di-ioc-container aria-label="1. Spring DI IOC container">1. Spring DI IOC container</a></li><li><a href=#2-full-application-context-springboottest aria-label="2. full application context @SpringBootTest">2. full application context @SpringBootTest</a></li><li><a href=#3-autoconfiguration aria-label="3. AutoConfiguration">3. AutoConfiguration</a></li><li><a href=#4-environment-abstractions aria-label="4. Environment Abstractions">4. Environment Abstractions</a></li></ul></li><li><a href=#mocking aria-label=Mocking>Mocking</a><ul><li><a href=#spring-boot aria-label="Spring Boot">Spring Boot</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><h1 id=testable-design-and-mocking>Testable Design and Mocking<a hidden class=anchor aria-hidden=true href=#testable-design-and-mocking>#</a></h1><hr><p>What is testable design, and what kinds of design in java are testable?</p><p>In Java, achieving a testable design is about adhering to principles and practices that minimize coupling, maximize cohesion, and facilitate isolation of components for testing. It involves strategic use of design patterns, architectural decisions that favor testability, and leveraging tools and frameworks that support automated testing. This approach not only makes your code more testable but also improves its overall design and maintainability.</p><h2 id=dummy-code-in-spring-boot>Dummy code in Spring boot<a hidden class=anchor aria-hidden=true href=#dummy-code-in-spring-boot>#</a></h2><p>Unfortunately, finding a code that is hard to test is nearly impossible in Spring Boot.In other words, Spring Boot is a near perfect project(in testable level), which is in line with its dominant position in the java framework system.</p><p><strong>Here is the reason why hard-to-test code hardly exists in Spring Boot:</strong></p><h3 id=1-spring-di-ioc-container>1. Spring DI IOC container<a hidden class=anchor aria-hidden=true href=#1-spring-di-ioc-container>#</a></h3><p>One of the major features of spring boot is the extensive use of Java reflection for dependency injection and inversion of control. This is the core of spring framework.Dependency injection makes it easy to replace actual dependencies in a test environment, using a simplified implementation or an instance created specifically for testing purposes.</p><h3 id=2-full-application-context-springboottest>2. full application context @SpringBootTest<a hidden class=anchor aria-hidden=true href=#2-full-application-context-springboottest>#</a></h3><p>Spring provides a powerful test context framework that supports test configuration classes and test data management. Besides, Spring Boot provides rich testing support, including annotations and tools for unit testing and integration testing, such as @SpringBootTest, @DataJpaTest, @WebMvcTest, etc. These tools and annotations simplify the setup of test environments, allowing developers to quickly write and execute tests, whether for a specific layer (such as the web layer, service layer, or persistence layer) or for the entire application.</p><h3 id=3-autoconfiguration>3. AutoConfiguration<a hidden class=anchor aria-hidden=true href=#3-autoconfiguration>#</a></h3><p>Different from a traditional Spring framework, Spring Boot uses autoconfigure to ensures the consistency and correctness of configuration. In a test environment, this means that the same auto-configuration principles can be used to set up the test environment, reducing testing problems caused by improperly configured test environments.</p><h3 id=4-environment-abstractions>4. Environment Abstractions<a hidden class=anchor aria-hidden=true href=#4-environment-abstractions>#</a></h3><p>Spring Boot provides a variety of environment abstractions, such as configuration files and configuration classes, allowing developers to flexibly configure applications according to the running environment (development, testing, production, etc.). These abstractions also apply to the test environment, making it easy to adjust the configuration of the test environment (such as database connections, external services, etc.) and avoid hardcoding these settings.</p><p>In summary, I think it is extremely difficult for dummy code to exist in the spring boot repo; mostly it will be rejected by the pull request peer review; And it will be short-term existence even if it does appear.</p><hr><h2 id=mocking>Mocking<a hidden class=anchor aria-hidden=true href=#mocking>#</a></h2><p>Mocking is a technique used in unit testing to simulate the behavior of real objects in a controlled way. It allows developers to isolate the unit of code they are testing by replacing its dependencies with mock objects. These mock objects can mimic the behavior of complex, real-world dependencies such as databases, web services, or other external systems without the overhead of setting up actual connections or state. Mocking is particularly useful in situations where the real dependencies are unreliable, slow, or difficult to configure for testing purposes.</p><p>Mocking is typically achieved using specialized libraries or frameworks designed for this purpose. Some popular mocking frameworks in the Java ecosystem include Mockito, JMock, and EasyMock. These frameworks provide annotations and APIs to create mock objects, define their behavior (e.g., specifying what values they should return when certain methods are called), and verify that they were interacted with in expected ways.</p><h3 id=spring-boot>Spring Boot<a hidden class=anchor aria-hidden=true href=#spring-boot>#</a></h3><p>In the process of observing spring boot testing, I found that spring boot rarely uses mocking to test their components. In spring boot philosophy, they tend to make the testing more simply. Spring Boot encourages testing with real components to ensure that parts of the application work together as expected. According to my rough statistics, only 1% of the code uses mockito, and most of this is intentional.</p><p>I made two test cases in spring boot actuator smoke test here is the detailed case:</p><p><img loading=lazy src=MockTestCase.png alt></p><p>The first case use the build-in mock call mockMvc, the other one is traditional mockito.</p><p>The first one is preferred in a current scenario. The mockito one is runnable but not recommended.</p><p><strong>MockMvc</strong> provides a powerful API that allows you to simulate HTTP requests and responses in order to test the behavior of the web layer without starting a full HTTP server.
<strong>Mockito</strong> is more used for general unit testing, especially when you need to simulate class or method behavior.</p><p>The first one interacts directly with the spring boot controller, constructs an http request, and verifies the response status code</p><p>The second one created a fictional <code>ResponseEntity</code> and mock the <code>RestTemplate</code>, the <code>MockResponseEntity</code> will return when specific url get call. The <code>ResponseEnitity</code> will return a small string that is some of the expected data and a http status code. However, this method has limitations because it does not actually construct an http request and call the actuator component, and may not reflect the real situation when the system is deployed.</p><p>Both tests passed.</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/spring-boot/>Spring Boot</a></li><li><a href=http://localhost:1313/tags/java/>Java</a></li><li><a href=http://localhost:1313/tags/actuator/>Actuator</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/springboottest6/><span class=title>« Prev</span><br><span>Spring Boot Software Testing 6 - Static Analyzers</span>
</a><a class=next href=http://localhost:1313/posts/springboottest4/><span class=title>Next »</span><br><span>Spring Boot Software Testing 4 - Continuous Integration</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Mr.W's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>