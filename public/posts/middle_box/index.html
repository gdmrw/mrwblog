<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How Middleboxs Identify Proxy Traffics | Mr.W's Blog</title>
<meta name=keywords content="http,tls"><meta name=description content="Abstract There is no absolute safe disguise, all protocols have risks of detected.
Common attack made by middle box Passive analysis (Traffic characteristic, PoC vulnerability) Usually use for plain text protocol or TLS handshake.
Active analysis Usually use for Shadowsocks, V2Ray, TLS v1.3 (obtian svers&rsquo;s SSL certificate)
replay package
Some obvious charecteristics of proxy traffic. Long connection Most HTTP traffic is short connection.
bidireaction flow 99% of Web traffic(HTTP) is one-way flow, which is a group of request match a group of response, few website use websocket."><meta name=author content="Coia"><link rel=canonical href=http://localhost:1313/posts/middle_box/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.01a996bd8bc49a236056f0facc1b09307c5c6829e3b89b8c08bf0ed176f60791.css integrity="sha256-AamWvYvEmiNgVvD6zBsJMHxcaCnjuJuMCL8O0Xb2B5E=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/middle_box/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="How Middleboxs Identify Proxy Traffics"><meta property="og:description" content="Abstract There is no absolute safe disguise, all protocols have risks of detected.
Common attack made by middle box Passive analysis (Traffic characteristic, PoC vulnerability) Usually use for plain text protocol or TLS handshake.
Active analysis Usually use for Shadowsocks, V2Ray, TLS v1.3 (obtian svers&rsquo;s SSL certificate)
replay package
Some obvious charecteristics of proxy traffic. Long connection Most HTTP traffic is short connection.
bidireaction flow 99% of Web traffic(HTTP) is one-way flow, which is a group of request match a group of response, few website use websocket."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/middle_box/"><meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-22T23:36:11+00:00"><meta property="article:modified_time" content="2022-10-22T23:36:11+00:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="How Middleboxs Identify Proxy Traffics"><meta name=twitter:description content="Abstract There is no absolute safe disguise, all protocols have risks of detected.
Common attack made by middle box Passive analysis (Traffic characteristic, PoC vulnerability) Usually use for plain text protocol or TLS handshake.
Active analysis Usually use for Shadowsocks, V2Ray, TLS v1.3 (obtian svers&rsquo;s SSL certificate)
replay package
Some obvious charecteristics of proxy traffic. Long connection Most HTTP traffic is short connection.
bidireaction flow 99% of Web traffic(HTTP) is one-way flow, which is a group of request match a group of response, few website use websocket."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"How Middleboxs Identify Proxy Traffics","item":"http://localhost:1313/posts/middle_box/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How Middleboxs Identify Proxy Traffics","name":"How Middleboxs Identify Proxy Traffics","description":"Abstract There is no absolute safe disguise, all protocols have risks of detected.\nCommon attack made by middle box Passive analysis (Traffic characteristic, PoC vulnerability) Usually use for plain text protocol or TLS handshake.\nActive analysis Usually use for Shadowsocks, V2Ray, TLS v1.3 (obtian svers\u0026rsquo;s SSL certificate)\nreplay package\nSome obvious charecteristics of proxy traffic. Long connection Most HTTP traffic is short connection.\nbidireaction flow 99% of Web traffic(HTTP) is one-way flow, which is a group of request match a group of response, few website use websocket.","keywords":["http","tls"],"articleBody":"Abstract There is no absolute safe disguise, all protocols have risks of detected.\nCommon attack made by middle box Passive analysis (Traffic characteristic, PoC vulnerability) Usually use for plain text protocol or TLS handshake.\nActive analysis Usually use for Shadowsocks, V2Ray, TLS v1.3 (obtian svers’s SSL certificate)\nreplay package\nSome obvious charecteristics of proxy traffic. Long connection Most HTTP traffic is short connection.\nbidireaction flow 99% of Web traffic(HTTP) is one-way flow, which is a group of request match a group of response, few website use websocket.\nHigh traffic Lack of reasons to justify large traffic.\nHigh connection numbers Normally a website will only create one websocket connection, hard to explain why there are 20-30 connections existed.\nPoint to point IP to IP, high encryption, high traffic, thus —- high suspiciousness\nThose charecteristics are always exist in proxy protocols, it will be hard to erase.\nTLS traffic risk analysis ClientHello TLS ClientHello have fingerprint\nIf access website using programs default fingerprint(for example: Go TLS) and match the features above. The risk that will be recongized by proxy will be high.\nIran firewall will reject curl and wget fingerprint request for non-whitelist, Go TLS and browsers fingerprint will be allowed. Recommende to connect by using browser’s fingerprint. (Go project uTLS) Note: this repository is disrepair and the chrome fingerprint remain at Chrome 83, it may be a risk. A changable option of the above is here , Chrome 104 fingerprint is currently added.\nServer Name Idication (SNI) Highest risk for free domains, cheap domains will also contain risk.\nTLS connection version TlS v1.3 has the highest risk, all contents after the Server Hello will be all encrypted, middlebox need active detection to obtain server certificate.\nTLS v1.2 will be considered as median risk. All certificates exchange will be in plain text, middle box can verify it through intercept traffic.\nSSL v3/TLS v1.0/TLS v1.1 have the lowest risk , there is few traffic here, in other words, fewer sample. However, using out-dated encryption have risk of being attacked, not recommended.\nTLS server certificate Self-signed certificate have the highest risk. Second are cloudflare certificate and Let’s Encrypt because they are free.\nAlmost no people will spent hunders of dollars on certificate.\nReport: New detection method that capable to detect Fake TLS traffic Analysis Both MTPRoto FakeTLS and Shadow TLS(v1/v2) are simulate a TLS handshake with trusted certificate to circumvent whitelist. Both two protocols are nearly perfect, they can be verified as valid client while handshake.\nHow to verify client of MTProto FakeTLS ClientHello package remove ramdom field and make a whole package for hmac, key will be secret, also use the hmac on sevrer to verify client, random have one-time processing, it will fallback to real web server if failed. Indentification method: TLS handshake of MTProto not standardize, firewall can intercept the hostCert package and judge the length. The lenght of hostCert will be ramdon, between 1024-4096 bit. (mtg-faketls)\nShadow TLS v1 won’t verify client Identification method: send a request to the sever through curl, curl will failed.\nHow Shadow TLS v2 verify client After client request, sever will return the orgin data as challenge response and use password to hmac. The server can verif the client using same hmac. Due to the return data have randomness and can also achieve one-time verification, middlebox can not react the challenge response if they don’t have password, hence, it will be more safer compare with MTproto handshake. New measure to detect client Most protocols security are based on server verify the client, but the client will not verify sever’s validity. In other words, one-way authentication Firewall can detect the server reaction by using fake server package. Using reverse dectection to check if the clients are real browser\nMTProto use hmac algorithm in ServerHello and will not affected by this measure.\nHow PoC identify the Shadow TLS v2 protocol desigin Github docs Firewall will intercept a normal TCP connection randomly. After they get TLS ClientHello, they will hijack the request content’s SNI field to real SNI server. After the TLS handshake finished, client of Shadow TLS will incert server’s challenge response 8 bit before the Application Data.\nAt this moment, because the opposite side is a real real TLS server, handshake with Shadow TLS client will be successful. But afer the hmac sent, server will drop an Alert(Encrypted Application Data) bacause it is not a negotiated TLS encryption. After that, the server will FIN or RST the TCP connection, at this time the ShadowTLS will be identified and can be block by ip precisely.\nProxy procotols will normally use multi connection. Middlebox can precisely identify the client by merely pick one of those connection.\nCurrently recommend proxy protocol Hystertia, TUIC(QUIC) The firewall does not block or interfere with QUIC, so you can use it with confidence. “This article is translate from Coia channel ,some emotional expressions have been deleted. This article not represent personal opinion \"\n","wordCount":"820","inLanguage":"en","image":"http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2022-10-22T23:36:11Z","dateModified":"2022-10-22T23:36:11Z","author":{"@type":"Person","name":"Coia"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/middle_box/"},"publisher":{"@type":"Organization","name":"Mr.W's Blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/archives/ title=Archieves><span>Archieves</span></a></li><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://localhost:1313/archive/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">How Middleboxs Identify Proxy Traffics</h1><div class=post-meta><span title='2022-10-22 23:36:11 +0000 UTC'>October 22, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;820 words&nbsp;·&nbsp;Coia</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#common-attack-made-by-middle-box>Common attack made by middle box</a></li><li><a href=#some-obvious-charecteristics-of-proxy-traffic>Some obvious charecteristics of proxy traffic.</a></li><li><a href=#tls-traffic-risk-analysis>TLS traffic risk analysis</a></li><li><a href=#report-new-detection-method-that--capable-to-detect-fake-tls-traffic>Report: New detection method that capable to detect Fake TLS traffic</a></li><li><a href=#new-measure-to-detect-client>New measure to detect client</a></li><li><a href=#how-poc-identify-the-shadow-tls-v2>How PoC identify the Shadow TLS v2</a></li><li><a href=#currently-recommend-proxy-protocol>Currently recommend proxy protocol</a></li></ul></nav></div></details></div><div class=post-content><h1 id=abstract>Abstract<a hidden class=anchor aria-hidden=true href=#abstract>#</a></h1><p>There is no absolute safe disguise, all protocols have risks of detected.</p><h2 id=common-attack-made-by-middle-box>Common attack made by middle box<a hidden class=anchor aria-hidden=true href=#common-attack-made-by-middle-box>#</a></h2><ul><li><p>Passive analysis (Traffic characteristic, PoC vulnerability)
Usually use for plain text protocol or TLS handshake.</p></li><li><p>Active analysis
Usually use for Shadowsocks, V2Ray, TLS v1.3 (obtian svers&rsquo;s SSL certificate)</p></li><li><p>replay package</p></li></ul><h2 id=some-obvious-charecteristics-of-proxy-traffic>Some obvious charecteristics of proxy traffic.<a hidden class=anchor aria-hidden=true href=#some-obvious-charecteristics-of-proxy-traffic>#</a></h2><ul><li><p>Long connection
Most HTTP traffic is short connection.</p></li><li><p>bidireaction flow
99% of Web traffic(HTTP) is one-way flow, which is a group of request match a group of response, few website use websocket.</p></li><li><p>High traffic
Lack of reasons to justify large traffic.</p></li><li><p>High connection numbers
Normally a website will only create one websocket connection, hard to explain why there are 20-30 connections existed.</p></li><li><p>Point to point
IP to IP, high encryption, high traffic, thus &mdash;- high suspiciousness</p></li></ul><p>Those charecteristics are always exist in proxy protocols, it will be hard to erase.</p><h2 id=tls-traffic-risk-analysis>TLS traffic risk analysis<a hidden class=anchor aria-hidden=true href=#tls-traffic-risk-analysis>#</a></h2><ul><li>ClientHello</li></ul><p>TLS ClientHello have <a href=https://fingerprint.com/blog/what-is-tls-fingerprinting-transport-layer-security/>fingerprint</a></p><p>If access website using programs default fingerprint(for example: Go TLS) and match the features above. The risk that will be recongized by proxy will be high.</p><blockquote><p>Iran firewall will reject curl and wget fingerprint request for non-whitelist, Go TLS and browsers fingerprint will be allowed.
Recommende to connect by using browser&rsquo;s fingerprint. (Go project <a href=https://github.com/refraction-networking/utls>uTLS</a>)
Note: this repository is disrepair and the chrome fingerprint remain at Chrome 83, it may be a risk.
A changable option of the above is <a href=https://gitlab.com/CoiaPrant/tls>here</a> , Chrome 104 fingerprint is currently added.</p></blockquote><ul><li><p>Server Name Idication (SNI)
Highest risk for free domains, cheap domains will also contain risk.</p></li><li><p>TLS connection version
TlS v1.3 has the highest risk, all contents after the Server Hello will be all encrypted, middlebox need active detection to obtain server certificate.</p></li></ul><p>TLS v1.2 will be considered as median risk. All certificates exchange will be in plain text, middle box can verify it through intercept traffic.</p><p>SSL v3/TLS v1.0/TLS v1.1 have the lowest risk , there is few traffic here, in other words, fewer sample. However, using out-dated encryption have risk of being attacked, not recommended.</p><ul><li>TLS server certificate</li></ul><p>Self-signed certificate have the highest risk.
Second are cloudflare certificate and Let&rsquo;s Encrypt because they are free.</p><blockquote><p>Almost no people will spent hunders of dollars on certificate.</p></blockquote><h2 id=report-new-detection-method-that--capable-to-detect-fake-tls-traffic>Report: New detection method that capable to detect Fake TLS traffic<a hidden class=anchor aria-hidden=true href=#report-new-detection-method-that--capable-to-detect-fake-tls-traffic>#</a></h2><p><strong>Analysis</strong>
Both MTPRoto FakeTLS and Shadow TLS(v1/v2) are simulate a TLS handshake with trusted certificate to circumvent whitelist. Both two protocols are nearly perfect, they can be verified as valid client while handshake.</p><ul><li>How to verify client of MTProto FakeTLS
ClientHello package remove ramdom field and make a whole package for hmac, key will be secret, also use the hmac on sevrer to verify client, random have one-time processing, it will fallback to real web server if failed.</li></ul><blockquote><p>Indentification method: TLS handshake of MTProto not standardize, firewall can intercept the hostCert package and judge the length. The lenght of hostCert will be ramdon, between 1024-4096 bit. (<a href=https://github.com/9seconds/mtg/tree/master/mtglib/internal/faketls>mtg-faketls</a>)</p></blockquote><ul><li>Shadow TLS v1 won&rsquo;t verify client</li></ul><blockquote><p>Identification method: send a request to the sever through curl, curl will failed.</p></blockquote><ul><li>How Shadow TLS v2 verify client
After client request, sever will return the orgin data as challenge response and use password to hmac. The server can verif the client using same hmac.
Due to the return data have randomness and can also achieve one-time verification, middlebox can not react the challenge response if they don&rsquo;t have password, hence, it will be more safer compare with MTproto handshake.</li></ul><h2 id=new-measure-to-detect-client>New measure to detect client<a hidden class=anchor aria-hidden=true href=#new-measure-to-detect-client>#</a></h2><p>Most protocols security are based on server verify the client, but the client will not verify sever&rsquo;s validity.
In other words, one-way authentication
Firewall can detect the server reaction by using fake server package. Using reverse dectection to check if the clients are real browser</p><blockquote><p>MTProto use hmac algorithm in ServerHello and will not affected by this measure.</p></blockquote><h2 id=how-poc-identify-the-shadow-tls-v2>How PoC identify the Shadow TLS v2<a hidden class=anchor aria-hidden=true href=#how-poc-identify-the-shadow-tls-v2>#</a></h2><blockquote><p>protocol desigin <a href=https://github.com/ihciah/shadow-tls/blob/master/docs/protocol-cn.md>Github docs</a>
Firewall will intercept a normal TCP connection randomly. After they get TLS ClientHello, they will hijack the request content&rsquo;s SNI field to real SNI server. After the TLS handshake finished, client of Shadow TLS will incert server&rsquo;s challenge response 8 bit before the Application Data.</p></blockquote><p>At this moment, because the opposite side is a real real TLS server, handshake with Shadow TLS client will be successful. But afer the hmac sent, server will drop an Alert(Encrypted Application Data) bacause it is not a negotiated TLS encryption. After that, the server will FIN or RST the TCP connection, at this time the ShadowTLS will be identified and can be block by ip precisely.</p><blockquote><p>Proxy procotols will normally use multi connection. Middlebox can precisely identify the client by merely pick one of those connection.</p></blockquote><h2 id=currently-recommend-proxy-protocol>Currently recommend proxy protocol<a hidden class=anchor aria-hidden=true href=#currently-recommend-proxy-protocol>#</a></h2><ul><li>Hystertia, TUIC(QUIC)
The firewall does not block or interfere with QUIC, so you can use it with confidence.</li></ul><blockquote><p>&ldquo;This article is translate from <a href=https://telegra.ph/%E6%8A%A5%E5%91%8A-%E4%B8%AD%E9%97%B4%E7%9B%92%E5%A6%82%E4%BD%95%E8%AF%86%E5%88%AB%E4%BB%A3%E7%90%86%E6%B5%81%E9%87%8F-10-17>Coia channel</a> ,some emotional expressions have been deleted. This article not represent personal opinion "</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/http/>Http</a></li><li><a href=http://localhost:1313/tags/tls/>Tls</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/qnap_ddns/><span class=title>« Prev</span><br><span>How to make QNAP NAS DDNS functional while using Tproxy</span>
</a><a class=next href=http://localhost:1313/posts/nginx_error/><span class=title>Next »</span><br><span>Nginx pid error fix</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Mr.W's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>